{% extends 'base.html' %}

{% block content %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Quiz: {{ quiz_name }}</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .question { margin-bottom: 24px; }    
    .choices { display: flex; flex-direction: column; gap: 8px; margin-top: 8px; }
    button.choice { 
        align-items: center;
        background-image: linear-gradient(144deg, #af40ff, #5b42f3 50%, #00ddeb);
        border: 0;
        border-radius: 8px;
        box-shadow: rgba(151, 65, 252, 0.2) 0 15px 30px -5px;
        box-sizing: border-box;
        color: #ffffff;
        display: flex;
        font-size: 20px;
        justify-content: center;
        line-height: 1em;
        max-width: 100%;
        min-width: 140px;
        padding: 3px;
        text-decoration: none;
        user-select: none;
        -webkit-user-select: none;
        touch-action: manipulation;
        white-space: nowrap;
        cursor: pointer;
        transition: all 0.3s;
        pointer-events: all;
     }
    button.choice.correct, button.choice.correct span { background: #d4edda; border-color: #28a745; color: #155724; }
    button.choice.incorrect, button.choice.incorrect span { background: #f8d7da; border-color: #dc3545; color: #721c24; }
    button.choice:disabled, button.choice:disabled span { opacity: 0.75; cursor: default; }
    button.choice.correct:disabled, button.choice.incorrect:disabled, button.choice.correct:disabled span, button.choice.incorrect:disabled span { opacity: 1; }
    button.choice:active,
    button.choice:hover {
        outline: 0;
    }

    button.choice span {
        background-color: rgb(5, 6, 45);
        padding: 16px 24px;
        border-radius: 6px;
        width: 100%;
        height: 100%;
        transition: 300ms;

    }

    button.choice:hover span {
        background: none;
    }

    button.choice:active {
        transform: scale(0.9);
    }
  </style>
</head>
<body>
  <div class="q-text shadowed-text"><h1>Quiz: {{ quiz_name }}</h1></div>
  <br>
  <div class="btn-row">
    <button class="button1" onclick="window.location.href='{{ url_for('home') }}'">
      <span>
          Home
      </span>
    </button>
    <button class="button1" onclick="window.location.href='{{ url_for('get_quizzes') }}'">
      <span>
          Back
      </span>
    </button>
  </div>
  <br>
  <div id="quiz">
    {% for q in questions %}
      <div class="question" data-q-index="{{ loop.index0 }}">
        <div class="q-text shadowed-text"><h2><strong>Q{{ loop.index }}.</strong> {{ q.question }}</h2></div>
        <div class="choices">
          {% for choice in q.choices %}
            <button class="choice"  type="button"
                    data-choice="{{ choice }}"
                    data-answer="{{ q.answer }}">
                    <span>
                        {{ choice }}
                    </span>
                </button>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
    <button onclick="submitQuiz('{{quiz_name}}')">Submit for feedback</button>
    <br>
    <div class="btn-row">
      <button class="button1" onclick="window.location.href='{{ url_for('home') }}'">
          <span>
              Home
          </span>
      </button>
      <button class="button1" onclick="window.location.href='{{ url_for('get_quizzes') }}'">
          <span>
              Back
          </span>
      </button>
      </div>
  </div>
  
  <script type="text/javascript">
    answers = new Array(10);
    currentQ = 0;
    document.querySelectorAll('.question').forEach(function(qElem) {
      const buttons = Array.from(qElem.querySelectorAll('button.choice'));
      buttons.forEach(function(btn) {
        btn.setAttribute("id",currentQ)
        btn.addEventListener('click', function() {
          // already answered
          if (buttons.some(b => b.disabled)) return;

          const selected = btn.getAttribute('data-choice').trim();
          const answer = btn.getAttribute('data-answer').trim();
          //add selected to form
          answers[btn.getAttribute("id")] = selected
          
          if (selected === answer) {
            btn.classList.add('correct');
          } else {
            btn.classList.add('incorrect');
            // reveal correct button
            const correctBtn = buttons.find(b => b.getAttribute('data-choice').trim() === answer);
            if (correctBtn) correctBtn.classList.add('correct');
          }

          // disable all choices for this question
          buttons.forEach(b => b.disabled = true);
        });
      });
      currentQ +=1;
    });
    function submitQuiz(name){
      quiz_form = new FormData();
      quiz_form.append("selected",JSON.stringify(answers))
      fetch('/serve_quiz/feedback/'+name, {
      method: "POST",
      // Set the FormData instance as the request body
      body: quiz_form,
    });
    }
  </script>
</body>
</html>
{% endblock %}